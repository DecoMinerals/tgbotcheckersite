#!/bin/bash

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
LOG_FILE="bot.log"
PID_FILE="bot.pid"
VENV_PATH="venv"  # –ü—É—Ç—å –∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º—É –æ–∫—Ä—É–∂–µ–Ω–∏—é, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å
PYTHON_BIN="$VENV_PATH/bin/python"  # –ü—É—Ç—å –∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä—É Python –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
BOT_SCRIPT="bot.py"  # –ò–º—è —Å–∫—Ä–∏–ø—Ç–∞ —Å –±–æ—Ç–æ–º

# –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ –±–æ—Ç
if [ -f "$PID_FILE" ]; then
    echo "‚ùå –ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω. PID —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: $(cat $PID_FILE)"
    exit 1
fi

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
nohup $PYTHON_BIN $BOT_SCRIPT >> $LOG_FILE 2>&1 &

# –ü–æ–ª—É—á–µ–Ω–∏–µ PID –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
echo $! > "$PID_FILE"

echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω, –ª–æ–≥–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ $LOG_FILE"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞
trap "echo 'üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞...'; kill $(cat $PID_FILE); rm -f $PID_FILE; exit" SIGINT SIGTERM
